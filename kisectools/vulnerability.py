from flask import Blueprint, render_template, request
from flask_security import login_required
from . import db
from .models import Vulnerability, Assets
vulnerability_bp = Blueprint('vulnerability', __name__)
@vulnerability_bp.route('/', methods=['GET'])
@login_required
def vulnerability():
    page = request.args.get('page', 1, type=int)
    per_page = request.args.get('per_page', 10, type=int)
    vulnerabilities = Vulnerability.query.paginate(page=page, per_page=per_page)
    responses = {
        'page': vulnerabilities.page,
        'per_page': vulnerabilities.per_page,
        'total': vulnerabilities.total,
        'data': [
            {
                'id': vuln.id,
                'name': vuln.name,
                'description': vuln.description,
                'severity': vuln.severity,
                'status': vuln.status,
                'create_time': vuln.create_time.strftime('%Y-%m-%d %H:%M:%S'),
            } for vuln in vulnerabilities.items
        ]
    }
    return render_template('vulnerability.html', vulnerabilities=responses)